<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="format-detection" content="telephone=no">
<title>jQuery</title>
<link rel="stylesheet" href="../../common/css/reset.css">
<link rel="stylesheet" href="../../common/css/base.css">
<link rel="stylesheet" href="./css/style.css">
</head>
<body>
<div class="wrapper">
  <h1 class="title">jQuery</h1>
  <h2 class="sub-title">Q1</h2>
  <div class="question">
    <div class="btn" id="q1">Q1</div>
  </div>
  <h2 class="sub-title">Q2</h2>
  <div class="question">
    <div class="btn" id="q2">Q2</div>
  </div>
  <h2 class="sub-title">Q3</h2>
  <div class="question">
    <div class="btn" id="q3">Q3</div>
  </div>
  <h2 class="sub-title">Q4</h2>
  <div class="question">
    <div class="btn" id="q4">Q4</div>
  </div>
  <h2 class="sub-title">Q5</h2>
  <div class="question">
    <div class="btn" id="q5">Q5</div>
  </div>
  <h2 class="sub-title">Q6</h2>
  <div class="question">
    <div class="btn" id="q6">Q6</div>
  </div>
  <h2 class="sub-title">Q7</h2>
  <div class="question">
    <ul class="list" id="q7">
      <li>Q7-1</li>
      <li>Q7-2</li>
      <li>Q7-3</li>
      <li>Q7-4</li>
    </ul>
  </div>
  <h2 class="sub-title">Q8</h2>
  <div class="question">
    <div class="btn" id="q8">Q8</div>
  </div>
  <h2 class="sub-title">Q9</h2>
  <div class="question">
    <div class="btn" id="q9" data-text="jQuery">Q9</div>
  </div>
  <h2 class="sub-title">Q10</h2>
  <div class="question">
    <ul class="list" id="q10">
      <li>Q10-1</li>
      <li>Q10-2</li>
      <li>Q10-3</li>
    </ul>
    <ul class="list" id="q11">
      <li>Q11-1</li>
      <li>Q11-2</li>
      <li>Q11-3</li>
    </ul>
  </div>
</div>
<script src="../../common/js/jquery.js"></script>
<script>
// 第1問  id='q1'の要素の文字色を赤色にせよ。
    $(function(){
      $('#q1').css('color', 'red');
// 第2問  id='q2'の要素をクリックしたら背景色をピンクにせよ。
    $('#q2').click(function(){
      $(this).css('background-color', 'cadetblue');
    });
// 第3問  id='q3'の要素をクリックしたら2秒かけてフェードアウトさせよ。
    $('#q3').click(fadeOut);
    function fadeOut() {
      $(this).fadeOut(2000);
    }
// 第4問  id='q4'の要素をクリックしたらこの要素の前後とこの要素内の前後にテキストを挿入せよ。
    $('#q4').click(function(){
      $(this).prepend('DOMの中の前')
             .append('DOMの中の前')
             .before('DOMの前')
             .after('DOMの後')
    });
// 第5問  id='q5'の要素をクリックしたらこの要素にlargeというクラスを付与せよ。
    $('#q5').click(function() {
      $(this).addClass('large');
    });
// 第6問  id='q6'の要素をクリックしたらこの要素を2秒かけてmargin-topとmargin-leftを100pxの位置に移動させよ。
    $('#q6').click(function(){
      $(this).animate({
        'marginLeft': 100,
        'marginTop': 100
      },2000);
    });
// 第7問  id='q7'の子要素をクリックしたら、その要素のインデックス（何番目か）をconsole.log()とalert()を用いて表示させよ。
    $('#q7').find('li').click(function(){
      var targetNum = $(this).index();
      console.log(targetNum);
      alert(targetNum);
    });
// 第8問  id='q8'の要素をhoverしたらlargeというクラスを付与し、hoverが外れたら、クラスを削除せよ。
    $('#q8').hover(function(){
      $(this).addClass('large');
    },function(){
      $(this).removeClass('large');
    });
// 第9問  id='q9'の要素をクリックしたらこの要素に設定してあるdata属性をconsoleに表示せよ。
    $('#q9').click(function(){
      var text = $(this).data('text');
      console.log(text);
    });
// 第10問 id='q10'の子要素をクリックしたら、その要素のインデックスと等しいid='q11'の子要素にlargeというクラスを追加せよ。
    $('#q10').find('li').on('click',function() {
      var num = $(this).index();
      $('#q11').find('li').eq(num).addClass('large');
    });
  });


  $(function(){
        var pageNum = 0;
        var previousword = '';
        $(".search__btn").on ('click',function(){
            var keyword = $('#js-search-word').val();
            if (previousword === keyword){
              pageNum = pageNum + 1;
            } else {
              $('.lists').empty();
              pageNum = 1;
            }
            
            previousword = keyword;

        $.ajax({
              url: 'https://app.rakuten.co.jp/services/api/BooksTotal/Search/20130522',
              type: 'GET',
              datatype: 'json',
              data: {
                page: pageNum,
                keyword: keyword,
                hits: 20,
                applicationId: '1019399324990976605', 
                booksGenreId: '001',
               }
        }).done(function(data) {
          if (0 < data.count){
            var list = '';
             $.each(data.Items,function(index,item){
               list += "<li class='lists__item'>" + 
                "<div class='lists__item__inner'>" +
                "<a href='" + item.Item.itemUrl + 
　　　　　　　　　　"'class='lists__item__link' target='_blank'>" + 
                "<img src='" + item.Item.mediumImageUrl +
　　　　　　　　　 "' class='lists__item__img' alt>" +
                "<p class='lists__item__detail'>作品名：　" + 
　　　　　　　　　　item.Item.title + '</p>' +
                "<p class='lists__item__detail'>作者　：　" + 
　　　　　　　　　　item.Item.author + '</p>' +
                "<p class='lists__item__detail'>出版社：　" +
　　　　　　　　　　 item.Item.publisherName + '</p>' + '</a>' +
                '</div>' + '</li>';
             })
             $('.lists').prepend(list);

           } else {
             $('.lists').html('<p class="message">検索結果が見つかりませんでした。<br>別のキーワードで検索して下さい。</p>');
           }
         }).fail(function(data){
          $('.lists').empty();
          if (data.readyState === 0){
            $('.lists').prepend('<p class="message">通信に失敗しました。<br>接続を確認してください。</p>');
          } else {
            $('.lists').each(function(){
            var error = data.responseJSON.error_description
            if (error === 'keyword must be set'){
               $(this).prepend('<p class="message">検索キーワードを入力して下さい。</p>');
            } else if (error === 'number of allowed requests has been exceeded for this API. please try again soon.'){
               $(this).prepend('<p class="message">検索ボタンを連打しないでください。</p>');
            } else{
              $(this).prepend('<p class="message">検索キーワードは漢字は１文字、ひらがな、カタカナ、数字、ローマ字は２文字以上入力してください。</p>');
            }
          });
          }
        })
      });
    });
</script>
</body>
</html>
